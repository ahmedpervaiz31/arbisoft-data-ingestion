Updated all code as per changes pointed out
